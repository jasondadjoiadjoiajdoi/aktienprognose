<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>KI Aktien Analyse 2026</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
  background:#0f1115;
  color:#e7fdf9;
  font-family:system-ui,Arial;
  margin:0;
  padding:12px;
}
h1{text-align:center;font-size:1.4rem;margin:6px 0}
small{text-align:center;display:block;color:#9cc}

select,button{
  width:100%;
  padding:14px;
  margin-top:10px;
  font-size:1rem;
  border-radius:12px;
  border:1px solid #00ccaa;
  background:#141822;
  color:#e7fdf9;
}

button:disabled{opacity:.6}
button:active{transform:scale(.97)}

.status{text-align:center;margin-top:8px;font-weight:bold}
.hint{text-align:center;font-size:.85rem;color:#9cc}

.progress{
  height:7px;
  background:#1e2433;
  border-radius:4px;
  overflow:hidden;
  margin-top:6px;
}
.progress div{
  height:100%;
  width:0%;
  background:#00ccaa;
  transition:width .3s;
}

.box{
  background:#141822;
  border:1px solid #00ccaa;
  border-radius:12px;
  padding:10px;
  margin-top:10px;
  font-size:.9rem;
}

canvas{
  margin-top:12px;
  background:#111;
  border-radius:12px;
}
</style>
</head>

<body>

<h1>KI Aktien Analyse 2026</h1>
<small>Mobile & Desktop ‚Äì stabil & ohne Freeze</small>

<select id="stock"></select>
<button id="analyzeBtn">üîç Analyse starten</button>

<div class="status" id="marketStatus">Marktstatus wird geladen‚Ä¶</div>
<div class="hint" id="countdown"></div>
<div class="status" id="status">Bereit</div>

<div class="progress"><div id="bar"></div></div>

<canvas id="chart" height="260"></canvas>

<div class="box">
  <b>Analyse-Hinweis</b>
  <div id="info">‚Äì</div>
</div>

<script>
/* ================= KONFIG ================= */
const FINNHUB_KEY="d5ohqjhr01qjast6qrjgd5ohqjhr01qjast6qrk0";

/* ================= AKTIEN ================= */
const STOCKS=[
 ["AAPL","Apple"],
 ["MSFT","Microsoft"],
 ["NVDA","NVIDIA"],
 ["TSLA","Tesla"],
 ["AMZN","Amazon"],
 ["GOOGL","Alphabet"],
 ["META","Meta"],
 ["SAP","SAP SE"],
 ["ASML","ASML"],
 ["NESN","Nestl√©"],
 ["ROG","Roche"],
 ["ABB","ABB"]
];

const MORE_STOCKS=[
 ["JPM","JPMorgan"],["V","Visa"],["MA","Mastercard"],
 ["KO","Coca-Cola"],["PEP","PepsiCo"],["PG","P&G"],
 ["NKE","Nike"],["DIS","Disney"],["INTC","Intel"],
 ["AMD","AMD"],["ORCL","Oracle"],["IBM","IBM"],
 ["TSM","TSMC"],["BABA","Alibaba"],["XOM","Exxon"],
 ["WMT","Walmart"],["COST","Costco"],["MCD","McDonald's"],
 ["SBUX","Starbucks"],["PFE","Pfizer"],["JNJ","Johnson & Johnson"],
 ["GS","Goldman Sachs"],["BAC","Bank of America"],
 ["HSBC","HSBC"],["BP","BP"],["UL","Unilever"],
 ["NVS","Novartis"],["SNY","Sanofi"]
];

const stockSel=document.getElementById("stock");
[...STOCKS,...MORE_STOCKS].forEach(s=>{
  const o=document.createElement("option");
  o.value=s[0]; o.textContent=s[0]+" ‚Äì "+s[1];
  stockSel.appendChild(o);
});

/* ================= MARKT ================= */
function getMarketForSymbol(s){
  if(["SAP","ASML","NESN","ROG","ABB"].includes(s)) return "EU";
  return "US";
}

function marketTimes(){
  const m=getMarketForSymbol(stockSel.value);
  const now=new Date(),d=now.getDay();
  const h=now.getHours()+now.getMinutes()/60;
  if(d===0||d===6) return {open:false,next:"Montag",market:m};
  if(m==="EU"){
    if(h>=9&&h<17.5) return {open:true,closeIn:17.5-h,market:m};
    if(h<9) return {open:false,openIn:9-h,market:m};
    return {open:false,next:"Morgen 09:00",market:m};
  }
  if(h>=15.5&&h<22) return {open:true,closeIn:22-h,market:m};
  if(h<15.5) return {open:false,openIn:15.5-h,market:m};
  return {open:false,next:"Morgen 15:30",market:m};
}

function updateMarket(){
  const m=marketTimes();
  const f=m.market==="EU"?"üá™üá∫ Europa":"üá∫üá∏ USA";
  if(m.open){
    marketStatus.textContent=`üü¢ B√∂rse offen (${f})`;
    countdown.textContent=`Schlie√üt in ca. ${Math.round(m.closeIn*60)} Minuten`;
  }else{
    marketStatus.textContent=`üî¥ B√∂rse geschlossen (${f})`;
    countdown.textContent=m.openIn
      ?`√ñffnet in ca. ${Math.round(m.openIn*60)} Minuten`
      :`N√§chste √ñffnung: ${m.next}`;
  }
}
setInterval(updateMarket,30000);
updateMarket();

/* ================= CHART ================= */
let chart;
function drawChart(d){
  if(chart) chart.destroy();
  chart=new Chart(chartEl,{
    type:"line",
    data:{labels:d.c.map((_,i)=>i),
      datasets:[{data:d.c,borderColor:"#00ccaa",tension:.3}]},
    options:{responsive:true,plugins:{legend:{display:false}}}
  });
}

const chartEl=document.getElementById("chart");
const bar=document.getElementById("bar");
const status=document.getElementById("status");
const info=document.getElementById("info");
const btn=document.getElementById("analyzeBtn");
function progress(p){bar.style.width=p+"%";}
</script>
<script>
/* ================= SYMBOL FIX ================= */
function normalizeSymbol(s){
  if(s==="SAP") return "SAP.DE";
  if(s==="ASML") return "ASML.AS";
  if(["NESN","ROG","ABB"].includes(s)) return s+".SW";
  return s;
}

/* ================= DATEN ================= */
async function loadMarketData(){
  try{
    const sym=normalizeSymbol(stockSel.value);
    const key="cache_"+sym;
    const c=localStorage.getItem(key);
    if(c){
      const j=JSON.parse(c);
      if(Date.now()-j.t<15*60*1000) return j.d;
    }
    const now=Math.floor(Date.now()/1000);
    const from=now-86400*120;
    const r=await fetch(
      `https://finnhub.io/api/v1/stock/candle?symbol=${sym}&resolution=D&from=${from}&to=${now}&token=${FINNHUB_KEY}`
    );
    const d=await r.json();
    if(d.s!=="ok") throw 0;
    localStorage.setItem(key,JSON.stringify({t:Date.now(),d}));
    return d;
  }catch{return null;}
}

/* ================= KI ================= */
let KI_AKTIV=true;
const kiBtn=document.createElement("button");
kiBtn.textContent="üß† KI: EIN";
document.body.insertBefore(kiBtn,marketStatus);
kiBtn.onclick=()=>{KI_AKTIV=!KI_AKTIV;kiBtn.textContent=KI_AKTIV?"üß† KI: EIN":"üß† KI: AUS";};

function runKI(d){
  if(!d.c||d.c.length<15){
    return{signal:"NICHT VERF√úGBAR",timing:"‚ö™ Zu wenig Daten",stability:0,invalid:"‚Äì",reasons:["‚Ä¢ Unzureichende Datenbasis"]};
  }
  const c=d.c,o=d.o||d.c,n=c.length-1;
  let s=0,r=[];
  if(c[n]>c[n-5]){s+=3;r.push("‚Ä¢ Aufw√§rtstrend");}
  if(c[n]>c[n-12]){s+=2;r.push("‚Ä¢ Mittelfristig positiv");}
  if(c[n]>c[n-1]){s+=2;r.push("‚Ä¢ Momentum positiv");}
  const vol=Math.abs(c[n]-c[n-4])/c[n];
  if(vol<0.03){s+=2;r.push("‚Ä¢ Ruhige Phase");}
  else{s-=1;r.push("‚Ä¢ Hohe Volatilit√§t");}
  if(c[n]>o[n]&&c[n-1]<o[n-1]){s+=2;r.push("‚Ä¢ Bullish Candlestick");}
  let sig="HALTEN"; if(s>=8)sig="KAUFEN"; if(s<=3)sig="VERKAUFEN";
  return{
    signal:sig,
    timing:s>=8?"üü¢ Guter Einstieg":s>=5?"üü° Beobachten":"üî¥ Schwach",
    stability:Math.min(98,45+s*6),
    invalid:(c[n]*0.965).toFixed(2),
    reasons:r
  };
}

function simpleAnalysis(d){
  const c=d.c,n=c.length-1;
  return{signal:"HALTEN",timing:"Neutral",stability:50,invalid:(c[n]*0.95).toFixed(2),reasons:["‚Ä¢ KI deaktiviert"]};
}

/* ================= START ================= */
btn.onclick=async()=>{
  btn.disabled=true;
  status.textContent="Analyse l√§uft‚Ä¶";
  progress(15);
  const d=await loadMarketData();
  if(!d){
    info.textContent="‚ö†Ô∏è Keine Daten verf√ºgbar";
    btn.disabled=false;return;
  }
  drawChart(d); progress(55);
  const r=KI_AKTIV?runKI(d):simpleAnalysis(d);
  info.innerHTML=`<b>Signal:</b> ${r.signal}<br>
  <b>Timing:</b> ${r.timing}<br>
  <b>Stabilit√§t:</b> ${r.stability}%<br>
  <b>Kipppunkt:</b> ${r.invalid}<br><br>${r.reasons.join("<br>")}`;
  progress(100);
  status.textContent="‚úÖ Analyse abgeschlossen";
  btn.disabled=false;
};
</script>

</body>
</html>
